---
title: "List of aphasia research studies in the US"
---

```{r, echo = F, results = "asis", layout = "l-body-outset"}
library(htmltools)
library(flexdashboard)
library(here)
library(tidyverse)
library(htmltools)
library(knitr)

data = readRDS("~/random_rprojects/find-aphasia-research/data/clinical_trials_listcols.rds") %>%
  select(BriefTitle, Condition, NCTId,
         OrgFullName, BriefSummary, DetailedDescription,
         Keyword, StudyType, EligibilityCriteria, HealthyVolunteers,
         MinimumAge, Gender, LocationCity, LocationState, ResponsiblePartyInvestigatorFullName,
         CentralContactEMail, CentralContactPhone, CentralContactName) %>%
  mutate(BriefTitle = gsub("[.]", "", x=BriefTitle),
         EligibilityCriteria = str_replace_all(EligibilityCriteria, "\n", "<br>"))

study <- function(data, i) {
  name = data$BriefTitle[i]
  NCT_ID = data$NCTId[i]
  university = unlist(data$OrgFullName[i])
  summary = unlist(data$BriefSummary[i])
  eCriteria = data$EligibilityCriteria[i]
  cities = paste0(
              tibble(cities = unlist(data$LocationCity[i]), states = unlist(data$LocationState[i])) %>%
              #rowwise() %>%
              mutate(location = paste(cities, states, sep = ", ")) %>%
              pull(location), collapse = "; "
    )
  pi_name = unlist(data$ResponsiblePartyInvestigatorFullName[i])
  contact_name = unlist(data$CentralContactName[i])
  contact_phone = unlist(data$CentralContactPhone[i])
  contact_email = unlist(data$CentralContactEMail[i])
    div(id=NCT_ID,
      class = "study",
      h3(class = "name", name),
      div(class = "university", paste("Institution:", university)),
      div(class = "pi", paste("Principle Investigator:", pi_name)),
      div(class = "cities", paste("Location(s):", cities)), 
      div(class = "contact_header", "Contact:", style = "font-size:1.1rem;margin-top:5px;margin-bottom:5px;"),
      div(class = "contact",
          HTML(knitr::kable(format = "html",
          tibble(Name = contact_name,
                 Phone = contact_phone,
                 Email = contact_email))
      )),
      div(class = "summary", HTML(summary)), br(),
      div(class = "eligibility", HTML(eCriteria))
      )
}

for(i in 1:nrow(data)){
  print(br())
  print(study(data, i = i))
}
```
    
    
    
    
    
```{r, eval = F, include = F}
library(bsplus)
library(htmltools)
library(flexdashboard)
library(here)
library(tidyverse)
library(htmltools)

data = readRDS("~/random_rprojects/find-aphasia-research/data/clinical_trials_listcols.rds") %>%
  select(BriefTitle, Condition, StartDate, NCTId,
         OrgFullName, BriefSummary, DetailedDescription,
         Keyword, StudyType, EligibilityCriteria, HealthyVolunteers,
         MinimumAge, Gender, LocationCity, LocationState, ResponsiblePartyInvestigatorFullName) %>%
  mutate(BriefTitle = gsub("[.]", "", x=BriefTitle),
         EligibilityCriteria = str_replace_all(EligibilityCriteria, "\n", "<br>"))

data_list = purrr::transpose(data)

new_list = list()

for(i in 1:nrow(data)){
  university = unlist(data$OrgFullName[i])
  summary = unlist(data$BriefSummary[i])
  eCriteria = data$EligibilityCriteria[i]
  cities = paste0(unlist(data$LocationCity[2]), collapse = ", ")
  pi_name = unlist(data$ResponsiblePartyInvestigatorFullName[i])
  
  content=  div(
      #class = "study",
      #h3(class = "name", name),
      div(class = "university", paste("Institution:", university)),
      div(class = "pi", paste("Principle Investigator:", pi_name)),
      div(class = "cities", paste("Location(s):", cities)), br(),
      div(class = "summary", HTML(summary)), br(),
      div(class = "eligibility", HTML(eCriteria))
    )
  
  new_list[[i]]=content
  
}
    
fn_append <- function(tag, title, content_tag) {
  bsplus::bs_append(
    tag,
    title = title,
    content = content_tag
  )
}

reduce2(
    data$BriefTitle,
    new_list,
    fn_append,
    .init = bs_accordion(id = "test2")
  )
```
    
    